(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};jQuery(function(){var e,n,i;return e=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.template="forum/answer-list",i.prototype.className="answer-list-view",i.prototype.initialize=function(){return this.challenge_slug=this.collection.getChallengeSlug(),this.question_id=this.collection.getQuestionId(),this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"change",this.render),this.listenTo(this.collection,"add",this.render)},i.prototype.render=function(){return $(this.el).html(n.appController.template(this.template,this)({challenge_slug:this.challenge_slug,question_id:this.question_id,collection:this.collection.toJSON()})),this.delegateEvents(),this},i.prototype.events={"click a.upvote-answer":"upvoteAnswer","click a.downvote-answer":"downvoteAnswer"},i.prototype.subscription=function(e){return e.preventDefault()},i.prototype.addAnswer=function(e){return this.collection.push(e)},i.prototype.upvoteAnswer=function(e){var t,n,i,o;return e.preventDefault(),o=$(e.currentTarget),o.hasClass("disabled")?void 0:(n=this,i=o.attr("href"),t=o.closest(".answer"),$.ajax({type:"PUT",url:i,success:function(){return n.highlightUpvote(t),n.collection.fetch()}}))},i.prototype.downvoteAnswer=function(e){var t,n,i,o;return e.preventDefault(),o=$(e.currentTarget),o.hasClass("disabled")?void 0:(n=this,i=o.attr("href"),t=o.closest(".answer"),$.ajax({type:"PUT",url:i,success:function(){return n.highlightDownvote(t),n.collection.fetch()}}))},i.prototype.highlightUpvote=function(e){return this.resetVotes(e),$(e).find(".upvote-answer").addClass("hide")},i.prototype.highlightDownvote=function(e){return this.resetVotes(e),$(e).find(".downvote-answer").addClass("hide")},i.prototype.resetVotes=function(e){return $(e).find(".upvote-answer,.downvote-answer").removeClass("hide")},i}(window.HR.GenericView),n=null!=(i=window.HR)?i:{},n.AnswerListView=e})}).call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};jQuery(function(){var e,n,i;return e=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.template="forum/challenge-ask-question",i.prototype.className="challenge-ask-question-view container",i.prototype.initialize=function(e){var t,i;return i=this,this.question=new n.QuestionModel,this.question.set({title:"",description:"",description_markdown:"",tags:[]}),e.question_id&&(t=e.challenge.get("slug"),this.question.set({id:e.question_id,challenge_slug:t}),this.question.fetch(),this.listenTo(this.question,"reset",this.render)),this.challenge=e.challenge,this.listenTo(this.challenge,"reset",this.render),this.listenTo(this.challenge,"change",this.render),this.challenge.fetch(),this.hacker=n.profile(),this.render},i.prototype.events={"click a.ask-question":"askQuestion"},i.prototype.askQuestion=function(e){var t,i,o,r,s,l,a,u;return e.preventDefault(),t=$(e.currentTarget),r=t.html(),i=_.escape(this.editor.getValue()),a=this.$("#question-title").val(),i.length<3||a.length<3?(this.$("#question-error").html("Title and Question should contain at least 3 characters."),this.$("#question-error").fadeIn(),t.removeClass("disabled"),setTimeout(function(){return function(){return $("#question-error").fadeOut()}}(this),2e3),void 0):(t.html("Posting..."),o=this.$("#question-error"),t.hasClass("disabled")?void 0:(t.addClass("disabled"),s=_.filter(this.$("#question-tags").val().split(", "),function(e){return e.trim().length>0}),l=this,this.question.set({challenge_slug:this.challenge.get("slug"),title:this.$("#question-title").val(),description:this.editor.getValue(),description_markdown:this.editor.getValue(),tags:_.map(s,function(e){return _.escape(e)})}),u=function(e,i){var s,a,u;return 200===i.status||i.model?(s=document.location.protocol+"//"+document.location.host,u=""+n.appController.get_current_contest_namespace()+"/challenges/"+l.challenge.get("slug")+"/forum/questions/"+e.id,a=s+u,n.router.navigate(u,!0)):(o.fadeIn(),setTimeout(function(){return function(){return o.fadeOut()}}(this),2e3)),t.removeClass("disabled"),t.html(r)},this.question.save(null,{error:u,success:u})))},i.prototype.updatePreview=function(){return n.requires(["sanitize"],function(e){return function(){var t;return t=HackDown.processData(e.editor.getValue()),""===t?e.$(".preview-wrap").hide():e.$(".preview-wrap").show(),e.$("#question-preview").html(t)}}(this))},i.prototype.render=function(){var e,t,i;return $(this.el).html(n.appController.viewLoader(64)),this.challenge.id?($(this.el).html(n.appController.template(this.template,this)({challenge:this.challenge,question:this.question})),i=this,t={lineNumbers:!1,lineWrapping:!0,matchBrackets:!0,mode:"text/x-markdown",indentUnit:4},e=this.$("#question-description").get(0),e?n.appController.loadCodeMirrorMode("markdown",function(n){return function(){return n.editor=CodeMirror.fromTextArea(e,t),n.editor.setSize(650,120),n.question.get("description_markdown")&&(n.editor.setValue(n.question.get("description_markdown")),i.updatePreview()),n.editor.on("change",function(){return i.updatePreview(),this})}}(this)):void 0):this},i}(window.HR.GenericView),n=null!=(i=window.HR)?i:{},n.ChallengeAskQuestionView=e})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};jQuery(function(){var e,n,i;return e=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.template="forum/challenge-questions-sidebar-header",i.prototype.className="challenge-questions-sidebar-header-view",i.prototype.initialize=function(e){return this.challenge=e.challenge,this.listenTo(n.profile(),"reset",this.render),this.render()},i.prototype.render=function(){return $(this.el).html(n.appController.template(this.template,this)({challenge:this.challenge,profile:n.profile()})),this},i}(window.HR.GenericView),n=null!=(i=window.HR)?i:{},n.ChallengeQuestionsSidebarHeaderView=e})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};jQuery(function(){var e,n,i;return e=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.template="forum/challenge-questions-sidebar",i.prototype.className="challenge-questions-sidebar-view",i.prototype.initialize=function(e){return this.challenge=e.challenge,this.render()},i.prototype.render=function(){var e;return $(this.el).html(n.appController.template(this.template,this)()),e=this,this.$(".header").length>0&&(this.header=new n.ChallengeQuestionsSidebarHeaderView({el:this.$(".header"),challenge:this.challenge})),this},i}(window.HR.GenericView),n=null!=(i=window.HR)?i:{},n.ChallengeQuestionsSidebarView=e})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};jQuery(function(){var e,n,i;return e=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.template="forum/challenge-questions",i.prototype.className="challenge-questions-view container",i.prototype.initialize=function(e){return this.challenge=e.challenge,this.listenTo(this.challenge,"reset",this.render)},i.prototype.render=function(){var e;return this.challenge.sync_status?($(this.el).html(n.appController.template(this.template,this)({challenge:this.challenge})),this.$("div#question-list-view").length>0&&(this.questions=new n.QuestionListView({el:this.$("div#question-list-view"),challenge:this.challenge,collection:this.collection}),this.questions.render()),this.$("div.sidebar").length>0&&(this.sidebar=new n.ChallengeQuestionsSidebarView({el:this.$("div.sidebar"),challenge:this.challenge}),this.sidebar.render()),e=n.util.renderBreadCrumbs(this.$("div.breadcrumbs"),this.challenge.breadCrumbs()),this.add_subview(e),this):this},i}(window.HR.GenericView),n=null!=(i=window.HR)?i:{},n.ChallengeQuestionsView=e})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};jQuery(function(){var e,n,i;return e=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.template="forum/follow-question",i.prototype.className="follow-question-view",i.prototype.initialize=function(e){return this.model=e.model,this.challenge=e.challenge,this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"reset",this.render),this.render()},i.prototype.events={"click a#follow-button":"toggleSubscription"},i.prototype.toggleSubscription=function(e){var t,i,o;return e.preventDefault(),i=this,t=$(e.currentTarget),o="/rest/contests/"+n.appController.get_current_contest_slug()+"/challenges/"+this.challenge.get("slug")+"/questions/"+this.model.get("id")+"/",o+=this.model.get("subscribed")?"unsubscribe":"subscribe",$.ajax({type:"PUT",url:o,success:function(){return i.model.fetch()}})},i.prototype.render=function(){var e;return e="Checkout question, '"+this.model.get("title")+"' on '"+this.challenge.get("name")+"'",$(this.el).html(n.appController.template(this.template,this)({model:this.model.toJSON(),challenge:this.challenge,shareText:e,profile:n.profile()})),this},i}(window.HR.GenericView),n=null!=(i=window.HR)?i:{},n.FollowQuestionView=e})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};jQuery(function(){var e,n,i;return n=function(n){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,n),i.prototype.template="forum/question-content",i.prototype.className="question-content-view",i.prototype.initialize=function(t){return this.challenge=t.challenge,this.answer_collection=t.answer_collection,this.hacker=e.profile(),this.listenTo(this.hacker,"reset",this.render),this.render()},i.prototype.render=function(){var t,n,i;return $(this.el).html(e.appController.template(this.template,this)({challenge:this.challenge,question:this.model.toJSON(),_question:this.model,profile:this.hacker,_profile:this.hacker.toJSON()})),i=this,n={lineNumbers:!1,lineWrapping:!0,matchBrackets:!0,mode:"text/x-markdown",indentUnit:4},t=this.$("#answer-description").get(0),t&&!this.editor&&e.appController.loadCodeMirrorMode("markdown",function(e){return function(){return e.editor=CodeMirror.fromTextArea(t,n),e.editor.setSize(null,120),e.editor.on("change",function(){return i.updatePreview(),this})}}(this)),this.$("div#answer-list-view").length>0&&this.loadAnswers(),$(".timeago").timeago(),this.delegateEvents(),this},i.prototype.loadAnswers=function(){return this.answers=new e.AnswerListView({el:this.$("div#answer-list-view"),collection:this.answer_collection}),this.answers.render()},i.prototype.events={"click a.answer-question":"answerQuestion","click a.upvote-question":"upvoteQuestion","click a.downvote-question":"downvoteQuestion","click a.delete-question":"deleteQuestion","click a.edit-question":"editQuestion"},i.prototype.answerQuestion=function(t){var n,i,o,r,s;return t.preventDefault(),i=$(t.currentTarget),o=this.editor.getValue(),o.length<3?(this.$("#answer-error").html("Sorry, your answer should contain at least 3 characters."),this.$("#answer-error").fadeIn(),i.removeClass("disabled"),setTimeout(function(){return function(){return $("#answer-error").fadeOut()}}(this),3e3),void 0):i.hasClass("disabled")&&o.length>0?void 0:(i.addClass("disabled"),r=i.html(),i.html("Posting..."),s=this,n=new e.AnswerModel,n.set({challenge_slug:this.challenge.get("slug"),question_id:this.model.get("id"),answer:{description:o}}),n.save({},{success:function(){return s.answers.addAnswer(n),s.editor.setValue(""),i.removeClass("disabled"),i.html(r),$("html, body").animate({scrollTop:$(document).height()},1e3)},error:function(){return this.$("#answer-error").fadeIn(),i.removeClass("disabled"),i.html(r),setTimeout(function(){return function(){return $("#answer-error").fadeOut()}}(this),3e3)}}))},i.prototype.updatePreview=function(){return e.requires(["sanitize"],function(e){return function(){var t;return t=HackDown.processData(e.editor.getValue()),""===t?e.$(".preview-wrap").hide():e.$(".preview-wrap").show(),e.$("#answer-preview").html(t)}}(this))},i.prototype.upvoteQuestion=function(e){var t,n,i;return e.preventDefault(),i=$(e.currentTarget),i.hasClass("disabled")?void 0:(t=this,n=i.attr("href"),$.ajax({type:"PUT",url:n,success:function(){return t.highlightUpvote()}}))},i.prototype.downvoteQuestion=function(e){var t,n,i;return e.preventDefault(),i=$(e.currentTarget),i.hasClass("disabled")?void 0:(t=this,n=i.attr("href"),$.ajax({type:"PUT",url:n,success:function(){return t.highlightDownvote()}}))},i.prototype.deleteQuestion=function(){var t;return t=""+e.appController.get_current_contest_namespace()+"/challenges/"+this.challenge.get("slug")+"/forum/questions",this.model.destroy(),e.router.navigate(t,!0)},i.prototype.editQuestion=function(){var t;return t=""+e.appController.get_current_contest_namespace()+"/challenges/"+this.challenge.get("slug")+"/forum/questions/ask/"+this.model.get("id"),e.router.navigate(t,!0)},i.prototype.highlightUpvote=function(){return this.resetVotes(),this.$(".upvote-question").addClass("highlight").addClass("disabled")},i.prototype.highlightDownvote=function(){return this.resetVotes(),this.$(".downvote-question").addClass("highlight").addClass("disabled")},i.prototype.resetVotes=function(){return this.$(".upvote-question,.downvote-question").removeClass("highlight").removeClass("disabled")},i}(window.HR.GenericView),e=null!=(i=window.HR)?i:{},e.QuestionContentView=n})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};jQuery(function(){var e,n,i;return n=function(n){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,n),i.prototype.template="forum/question-list",i.prototype.className="question-list-view",i.prototype.initialize=function(e){return this.challenge=e.challenge,this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"change",this.render),this.listenTo(this.collection,"add",this.render),this.listenTo(this.collection,"set",this.render),this.listenTo(this.collection,"sync",this.render),this.collection.fetch()},i.prototype.render=function(){var t,n;return $(this.el).html(e.appController.template(this.template,this)({challenge:this.challenge,collection:this.collection.toJSON(),_collection:this.collection})),t=$(),n=this,$(".question-stub-container").html(""),this.collection.sync_status&&_.each(this.collection.models,function(i){var o;return o=new e.QuestionStubView({challenge:n.challenge,model:i}),t.push(o.render().el)}),$(".question-stub-container").append(t),this.delegateEvents(),e.util.pagination(this.$(".pagination-wrapper"),this.collection.getTotal(),""+e.appController.get_current_contest_namespace()+this.collection.pageURL()+"/page/",this.collection.getCurrentPage(),null,this.collection.limit),$(".timeago").timeago(),this},i.prototype.events={"click a.ask-question":"askQuestion"},i.prototype.askQuestion=function(t){var n,i,o;return t.preventDefault(),o=this,i=new e.QuestionModel,n={title:this.$("#question-title").val(),description:this.$("#question-description").val()},i.set({challenge_slug:this.challenge.get("slug"),question:n}),i.save(null,{success:function(){return o.collection.add(i)}})},i}(window.HR.GenericView),e=null!=(i=window.HR)?i:{},e.QuestionListView=n})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};jQuery(function(){var e,n,i;return n=function(n){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,n),i.prototype.template="forum/question-sidebar",i.prototype.className="question-sidebar-view",i.prototype.initialize=function(e){return this.activites_collection=e.activities_collection,this.challenge=e.challenge,this.render()},i.prototype.render=function(){var t;return $(this.el).html(e.appController.template(this.template,this)({challenge:this.challenge})),t=this,this.$(".follow-question").length>0&&(this.header=new e.FollowQuestionView({el:this.$(".follow-question"),model:this.model,challenge:this.challenge})),this},i}(window.HR.GenericView),e=null!=(i=window.HR)?i:{},e.QuestionSidebarView=n})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};jQuery(function(){var e,n,i;return n=function(n){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,n),i.prototype.template="forum/question-stub",i.prototype.className="question-stub-view",i.prototype.initialize=function(e){return this.challenge=e.challenge},i.prototype.render=function(){return $(this.el).html(e.appController.template(this.template,this)({challenge:this.challenge,question:this.model.toJSON(),_model:this.model})),this.delegateEvents(),this},i.prototype.events={"click a.question-link":"loadQuestion"},i.prototype.loadQuestion=function(e){return e.preventDefault(),this.model.trigger("question:link:clicked",this.model)},i}(window.HR.GenericView),e=null!=(i=window.HR)?i:{},e.QuestionStubView=n})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};jQuery(function(){var e,n,i;return n=function(n){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,n),i.prototype.template="forum/question",i.prototype.className="questions container",i.prototype.initialize=function(t){var n;return n=this,this.answer_collection=new e.AnswerCollection,this.answer_collection.setChallengeSlug(this.model.get("challenge_slug")),this.answer_collection.setQuestionId(this.model.id),this.listenTo(this.answer_collection,"reset",this.render),this.listenTo(this.answer_collection,"change",this.render),this.answer_collection.cached(),this.challenge=t.challenge,this.listenTo(this.challenge,"reset",this.render),this.listenTo(this.challenge,"change",this.render),this.model.setChallenge(this.challenge),this.challenge.cached(),this.listenTo(this.model,"reset",this.render),this.listenTo(this.model,"change",this.render),this.model.fetch(),this.profile=e.profile()},i.prototype.render=function(){var t;return $(this.el).html(e.appController.viewLoader(64)),this.model.sync_status&&this.challenge.sync_status?($(this.el).html(e.appController.template(this.template,this)({challenge:this.challenge})),this.$("div#question-content-view").length>0&&(this.questions=new e.QuestionContentView({el:this.$("div#question-content-view"),challenge:this.challenge,model:this.model,answer_collection:this.answer_collection})),this.$("div.sidebar").length>0&&(this.sidebar=new e.QuestionSidebarView({el:this.$("div.sidebar"),challenge:this.challenge,model:this.model})),t=e.util.renderBreadCrumbs(this.$("div.breadcrumbs"),this.model.breadCrumbs()),this.add_subview(t),this):this},i}(window.HR.GenericView),e=null!=(i=window.HR)?i:{},e.QuestionView=n})}.call(this);
//# sourceMappingURL=forum-views-d59d2652915e423618493d6d55af08e3.js.map