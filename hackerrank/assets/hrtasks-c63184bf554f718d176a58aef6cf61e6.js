(function(){$("document").ready(function(){var e,t;e={},window.HR=e,e.CredentialsModel=Backbone.Model.extend({intialize:function(){},url:"endpoint-recieve"}),e.MachineModel=Backbone.Model.extend({intialize:function(){},url:function(){return this.isNew()?"/x/api/v1/instances":"/x/api/v1/instances/"+this.get("id")},startMachine:function(){e.notifications.push("info","Starting instance: "+this.get("id")),this.save({instance_action:"start"},{success:function(t,i){e.notifications.push("success","Instance started"),t.set(i.model)}})},stopMachine:function(){e.notifications.push("info","Stopping instance: "+this.get("id")),this.save({instance_action:"stop"},{success:function(t,i){e.notifications.push("success","Instance stopped"),t.set(i.model)}})},setPassword:function(t,i,n,s){null==s&&(s=24),e.notifications.push("info","Setting up task, and password on: "+this.get("id")),this.save({instance_action:"setup",password:t,sudo:i,hours:s,reportname:n},{success:function(t,i){e.notifications.push("success","Task, and password setup. You may now share the login details with the candidate."),t.set(i.model)}})},flashMessage:function(t){e.notifications.push("info","Sending flash command.. "+this.get("id")),this.save({instance_action:"flashmsg",message:t},{success:function(t,i){e.notifications.push("success","Message flashed."),t.set(i.model)}})},lockReport:function(){e.notifications.push("info","Logging candidate out and building report"+this.get("id")),this.save({instance_action:"lockbuild"},{success:function(t,i){e.notifications.push("success","Done. Report available via 'Report URL' above."),t.set(i.model)}})},removeMachine:function(){e.notifications.push("info","Removing Machine : "+this.get("id")),this.save({instance_action:"remove"},{success:function(t,i){e.notifications.push("success","Machined marked for removal"),t.set(i.model)}})},parse:function(t){var i;return e.notifications.push("success","Machine configurations fetched"),i=t.model?t.model:t,("pending"===i.status||"stopping"===i.status)&&(console.log("Test"),clearTimeout(window.tout),window.tout=setTimeout(this.fetch,1e4)),i}}),e.TaskModel=Backbone.Model.extend({initialize:function(){},urlRoot:"/x/api/v1/tasks",startNewInstance:function(t){e.notifications.push("info","Starting new instance for task  "+this.get("name")),$.ajax({url:"/x/api/v1/instances",type:"POST",data:{task_id:this.id,description:t},success:function(t){var i;t.model&&(i=new e.MachineModel(t.model),e.machines.add(i),e.notifications.push("success","New instance created."),e.router.navigate("machines/"+t.model.id+"/configure",!0))}})},parse:function(e){return e.model?e.model:e}}),e.ReportModel=Backbone.Model.extend({initialize:function(){},urlRoot:"/x/api/v1/taskreports",parse:function(e){return e.model?e.model:e}}),e.UserModel=Backbone.Model.extend({initialize:function(){},url:"/x/api/v1/tasks/login",checkLogin:function(e,t,i){var n;n=this,this.set({error:!1}),$.ajax({url:this.url,type:"POST",data:{company:e,password:t},success:function(e){n.set(e.model),i&&i()},error:function(){n.set({error:!0})}})},getLogin:function(e){var t;t=this,$.ajax({url:this.url,type:"POST",success:function(i){t.set(i.model),e()},error:function(){t.set({error:!0})}})},logout:function(){$.get("/x/api/v1/tasks/logout"),setTimeout(function(){e.router.navigate("login",!0)},500)}}),e.MachineCollection=Backbone.Collection.extend({model:e.MachineModel,initialize:function(){this.constructor.__super__.initialize.apply(this)},url:"/x/api/v1/instances",parse:function(t){return"machines"!==Backbone.history.fragment&&clearInterval(window.collectiontimer),e.notifications.push("success","Machines list fetched"),t.models}}),e.TaskCollection=Backbone.Collection.extend({model:e.TaskModel,initialize:function(){this.constructor.__super__.initialize.apply(this)},url:"/x/api/v1/tasks",parse:function(e){return e.models}}),e.ReportCollection=Backbone.Collection.extend({model:e.ReportModel,initialize:function(){this.constructor.__super__.initialize.apply(this)},url:"/x/api/v1/taskreports",parse:function(e){return e.models}}),e.LoginView=Backbone.View.extend({el:"#displayPanel",intialize:function(e){this.model=e.model},render:function(){var e;return e=_.template($("#login-template").html(),window),this.$el.html(e),this},events:{"submit form[name=login-form]":"loginUser"},loginUser:function(t){var i,n;t.preventDefault(),n=this.$el.find("input[name=user]").val(),i=this.$el.find("input[name=pass]").val(),this.model.on("change",this.checkStatus,this),this.model.checkLogin(n,i,function(){e.router.navigate("home",!0)})},checkStatus:function(){e.current_user.get("name")?e.router.navigate("home",!0):e.current_user.get("error")&&$(this.el).find(".login-error").show()}}),e.HomeView=Backbone.View.extend({el:"#displayPanel",intialize:function(e){this._super("intialize",e)},render:function(){var e;return e=_.template($("#home-template").html(),window),this.$el.html(e),this}}),e.NavView=Backbone.View.extend({el:"#navPanel",events:{"click #logout":"logout"},intialize:function(e){this.activeLink="home",this._super("intialize",e)},setActive:function(e){return this.activeLink=e,this},render:function(){var e;return e=_.template($("#navigation-template").html(),{activeLink:this.activeLink}),this.$el.html(e),this},logout:function(){e.current_user.logout()}}),e.TasksView=Backbone.View.extend({el:"#displayPanel",intialize:function(){this.constructor.__super__.initialize.apply(this)},events:{"click .startBtn":"startNewInstance"},startNewInstance:function(e){var t,i,n;t=window.prompt("Please enter a description/candidate email for instance"),t&&(n=$(e.target).data("id"),i=this.collection.where({id:n})[0],i.startNewInstance(t))},render:function(){var e;return e=_.template($("#tasks-template").html(),{tasks:this.collection.toJSON()}),this.$el.html(e),this}}),e.TaskEditView=Backbone.View.extend({el:"#displayPanel",intialize:function(){this.constructor.__super__.initialize.apply(this)},events:{"click .startBtn":"startNewInstance","click #save":"saveData"},startNewInstance:function(){var e,t;return this.model.isNew()?e=window.prompt("Please enter a description/candidate email for instance"):(t=this.model.id,this.model.startNewInstance(e),void 0)},render:function(){var e;return e=_.template($("#task-edit-template").html(),{task:this.model.toJSON()}),this.$el.html(e),this},saveData:function(){var t;t={name:this.$el.find("#name").val(),description:this.$el.find("#description").val(),script:this.$el.find("#script").val(),duration:60},this.model.save(t,{success:function(){e.notifications.push("success","Task has been saved/updated")}})}}),e.MachineView=Backbone.View.extend({el:"#displayPanel",intialize:function(e){this.collection=e.collection,this._super("intialize",e)},events:{"click .startBtn":"startMachine","click .stopBtn":"stopMachine","click .refresh":"refreshList"},refreshList:function(){e.notifications.push("info","Fetching instances list"),this.collection.fetch()},render:function(){var e;return this.collection.on("reset",this.render,this),this.collection.on("add",this.render,this),this.collection.on("change",this.render,this),this.collection.on("remove",this.render,this),$("#displayPanel").empty(),e=_.template($("#machines-list-view").html(),{machines:this.collection.toJSON()}),this.$el.html(e),this},startMachine:function(e){var t,i;$(e.target).hasClass("disabled")||(i=$(e.target).data("machine"),t=this.collection.where({id:i})[0],t.startMachine())},stopMachine:function(e){var t,i;$(e.target).hasClass("disabled")||(i=$(e.target).data("machine"),t=this.collection.where({id:i})[0],t.stopMachine())}}),e.ReportsView=Backbone.View.extend({el:"#displayPanel",intialize:function(e){this.collection=e.collection,this._super("intialize",e)},refreshList:function(){e.notifications.push("info","Fetching instances list"),this.collection.fetch()},render:function(){var e;return this.collection.on("reset",this.render,this),this.collection.on("add",this.render,this),this.collection.on("change",this.render,this),this.collection.on("remove",this.render,this),$("#displayPanel").empty(),e=_.template($("#reports-template").html(),{reports:this.collection.toJSON()}),this.$el.html(e),this}}),e.ConfigView=Backbone.View.extend({el:"#displayPanel",intialize:function(e){this.model=e.model,this._super("intialize",e)},events:{"click .start":"startMachine","click .stop":"stopMachine","click .remove":"removeMachine","click .setup-pw":"showSetup","click .flash-message":"flashMessage","click .setuptask":"setupTask","click .canceltask":"cancelTask","click .lockreport":"lockReport"},render:function(){var e;return console.log("Machine:",this.model),this.model.get("status")?(e=_.template($("#params-template").html(),{machine:this.model.toJSON()}),this.$el.html(e),this):(this.model.on("change",this.render,this),void 0)},startMachine:function(){this.model.startMachine()},stopMachine:function(){this.model.stopMachine()},removeMachine:function(){this.model.removeMachine()},showSetup:function(){this.$(".setuppanel").removeClass("hide")},setupTask:function(){var e,t,i,n;t=this.$(".passwd").val(),n=this.$(".sudocheck").prop("checked"),e=this.$(".hours").val(),i=this.$(".reportname").val(),this.model.setPassword(t,n,i,e),this.$(".setuppanel").addClass("hide")},cancelTask:function(){this.$(".setuppanel").addClass("hide")},flashMessage:function(){var e;e=prompt("What message would you like to flash to logged in sessions?"),e&&this.model.flashMessage(e)},lockReport:function(){var e;e=confirm("This will disconnect the user, and disable any further user login.\n\nAre you sure you want to disconnect the user, and build report?"),e&&this.model.lockReport()}}),e.CredentialsView=Backbone.View.extend({el:"#appView",initialize:function(e){this.model=e.model},render:function(){var e;return e=_.template($("#notifications-template").html(),{model:this.model.toJSON()}),this.$el.html(e),this}}),e.AppView=Backbone.View.extend({el:"#appView",initialize:function(){this.appView=null},renderSubView:function(t,i){e.navView||(e.navView=new e.NavView),e.navView.setActive(i).render(),this.appView&&(this.appView.undelegateEvents(),this.appView.remove(),this.$el.find("#displayPanel").remove(),this.$el.append("<div id='displayPanel'></div> ")),t.setElement("#displayPanel"),this.appView=t,t.render()}}),e.NotificationView=Backbone.View.extend({el:"#notificationPanel",push:function(e,t){this.type=e,this.message=t,this.render()},render:function(){var e,t;return e=_.template($("#notifications-template").html(),{type:this.type,message:this.message}),this.$el.html(e),clearTimeout(this.timeout),t=this,"success"===this.type&&(this.timeout=setTimeout(function(){$("#notificationPanel .panel").fadeOut()},3e3)),this}}),t=Backbone.Router.extend({routes:{login:"login",home:"home",tasks:"tasks","tasks/new":"newtask","tasks/:id/edit":"edittask",machines:"machines","machines/:id/configure":"configure",reports:"reports","getlogin/:id":"credentials","*path":"default"},initialize:function(){},credentials:function(t){var i,n;i=new e.CredentialsModel({id:t}),n=new e.CredentialsView({model:i}),e.appView.renderSubView(n)},checkLogin:function(){var t;return e&&e.current_user&&e.current_user.get("id")?!0:$.cookie("t_company")?(e.current_user||(t=new e.UserModel,t.getLogin(function(){e.current_user=t,e.router.navigate("home",{trigger:!0,replace:!0})})),this.navigate("login"),!1):(this.navigate("login",!0),!1)},"default":function(){this.navigate("login",!0)},login:function(){var t,i,n;$.cookie("t_company")?(i=new e.UserModel,i.getLogin(function(){e.current_user=i,e.router.navigate("home",{trigger:!0,replace:!0})}),e.router.navigate("home",{trigger:!0,replace:!0})):(n=new e.UserModel,e.current_user=n,t=new e.LoginView({model:n}),e.appView.renderSubView(t))},home:function(){return this.checkLogin()?e.appView.renderSubView(new e.HomeView,"home"):void 0},tasks:function(){return this.checkLogin()?(e.notifications.push("info","Fetching tasks"),e.tasks.fetch({success:function(t){var i;i=new e.TasksView({collection:t}),e.appView.renderSubView(i,"tasks")}})):void 0},newtask:function(){var t;if(this.checkLogin())return t=new e.TaskEditView({model:new e.TaskModel}),e.appView.renderSubView(t,"tasks")},edittask:function(t){var i;if(this.checkLogin())return i=new e.TaskModel({id:t}),i.fetch({success:function(t){var i;i=new e.TaskEditView({model:t}),e.appView.renderSubView(i,"tasks")}})},machines:function(){var t;if(this.checkLogin())return 0===e.machines.length&&(e.machines.fetch({add:!0}),e.notifications.push("info","Fetching instances list")),t=new e.MachineView({collection:e.machines}),e.appView.renderSubView(t,"machines"),window.collectiontimer&&clearInterval(window.collectiontimer),window.collectiontimer=setInterval(function(){e.current_user&&e.machines.fetch()},2e4)},reports:function(){return this.checkLogin()?(e.notifications.push("info","Fetching reports"),e.reports.fetch({success:function(t){var i;return i=new e.ReportsView({collection:t}),e.appView.renderSubView(i,"reports")}})):void 0},configure:function(t){var i,n;if(this.checkLogin())return n=null,n=e.machines.where({id:t})[0],n||(n=new e.MachineModel({id:t}),n.fetch(),e.notifications.push("info","Fetching configurations")),i=new e.ConfigView({model:n}),e.appView.renderSubView(i,"configure")}}),e.notifications=new e.NotificationView,e.router=new t,e.appView=new e.AppView,e.machines=new e.MachineCollection,e.tasks=new e.TaskCollection,e.reports=new e.ReportCollection,Backbone.history.start({pushState:!1,root:window.location.pathname}),$("a.backbone-route").on("click",function(t){t.preventDefault(),e.router.navigate($(t.target).attr("href"),!0)})})}).call(this);
//# sourceMappingURL=hrtasks-97bcbf49057a8a365eb0a9c01c982534.js.map